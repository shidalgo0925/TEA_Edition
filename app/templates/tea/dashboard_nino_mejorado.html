<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† 1% Mejor Cada D√≠a - TEA Edition</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/interactive_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/button-colors.css') }}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #FFE5B4 0%, #FFD700 50%, #FFA500 100%);
            min-height: 100vh;
            color: #2C3E50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Estilos espec√≠ficos del dashboard */
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .nav-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .nav-button:hover, .nav-button:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
            outline: 3px solid #FFD700;
        }
        
        .welcome-message {
            font-size: 2.5rem;
            color: #E74C3C;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #7F8C8D;
            margin-bottom: 20px;
        }
        
        /* Tutorial/Gu√≠a inicial */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .tutorial-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .tutorial-step {
            display: none;
        }
        
        .tutorial-step.active {
            display: block;
        }
        
        .tutorial-title {
            font-size: 1.8rem;
            color: #E74C3C;
            margin-bottom: 15px;
        }
        
        .tutorial-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .tutorial-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn-tutorial {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #95A5A6;
            color: white;
        }
        
        .btn-tutorial:hover, .btn-tutorial:focus {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            outline: 3px solid #FFD700;
        }
        
        /* Estad√≠sticas mejoradas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .stat-card:hover, .stat-card:focus {
            transform: translateY(-5px);
            border-color: #FFD700;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #E74C3C;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #7F8C8D;
            font-weight: bold;
        }
        
        /* Categor√≠as mejoradas */
        .categories-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #2C3E50;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .category-card:hover, .category-card:focus {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            border-color: #FFD700;
            outline: none;
        }
        
        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .category-card:hover::before {
            left: 100%;
        }
        
        .category-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .category-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2C3E50;
        }
        
        .category-description {
            font-size: 1rem;
            color: #7F8C8D;
            margin-bottom: 15px;
        }
        
        .category-progress {
            background: #ECF0F1;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .category-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498DB, #2ECC71);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .category-status {
            font-size: 0.9rem;
            font-weight: bold;
            color: #27AE60;
        }
        
        /* Bot√≥n de acci√≥n principal */
        .action-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .btn-start {
            background: linear-gradient(135deg, #27AE60 0%, #2ECC71 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
            text-decoration: none;
            display: inline-block;
            position: relative;
            overflow: hidden;
        }
        
        .btn-start:hover, .btn-start:focus {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(39, 174, 96, 0.4);
            outline: 3px solid #FFD700;
        }
        
        .btn-start::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .btn-start:hover::before {
            left: 100%;
        }
        
        /* Zona de pausa/descanso */
        .rest-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .btn-rest {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn-rest:hover, .btn-rest:focus {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
            outline: 3px solid #FFD700;
        }
        
        /* Medallas e Insignias */
        .medals-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .medals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .medal-card {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .medal-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
            border-color: #FF6B6B;
        }
        
        .medal-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }
        
        .medal-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 5px;
        }
        
        .medal-description {
            font-size: 0.8rem;
            color: #34495E;
            line-height: 1.3;
        }

        /* Recomendaciones personalizadas */
        .recommendations {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .recommendation-item {
            background: #F8F9FA;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #3498DB;
            transition: all 0.3s ease;
        }
        
        .recommendation-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        /* Animaciones suaves */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Animaciones del avatar */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes wiggle {
            0%, 7% { transform: rotateZ(0); }
            15% { transform: rotateZ(-15deg); }
            20% { transform: rotateZ(10deg); }
            25% { transform: rotateZ(-10deg); }
            30% { transform: rotateZ(6deg); }
            35% { transform: rotateZ(-4deg); }
            40%, 100% { transform: rotateZ(0); }
        }
        
        @keyframes glow {
            0% { text-shadow: 0 0 5px currentColor; }
            50% { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
            100% { text-shadow: 0 0 5px currentColor; }
        }
        
        .avatar {
            transition: all 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.1);
            cursor: pointer;
        }
        
        .avatar-bubble {
            animation: fadeInUp 0.5s ease-out;
        }
        
        /* Accesibilidad */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus visible para navegaci√≥n por teclado */
        *:focus {
            outline: 3px solid #FFD700;
            outline-offset: 2px;
        }
        
        /* Contraste mejorado */
        .high-contrast {
            background: #000;
            color: #FFF;
        }
        
        .high-contrast .header,
        .high-contrast .stat-card,
        .high-contrast .category-card,
        .high-contrast .rest-section,
        .high-contrast .recommendations {
            background: #333;
            color: #FFF;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .welcome-message {
                font-size: 2rem;
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-persistente {
                padding: 10px;
            }
            
            .nav-item {
                min-width: 60px;
            }
            
            .nav-icon {
                font-size: 20px;
            }
            
            .nav-text {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Tutorial/Gu√≠a inicial -->
    <div class="tutorial-overlay" id="tutorialOverlay" role="dialog" aria-labelledby="tutorialTitle" aria-modal="true">
        <div class="tutorial-content">
            <div class="tutorial-step active" id="step1">
                <h2 class="tutorial-title" id="tutorialTitle">¬°Bienvenido a tu espacio de aprendizaje!</h2>
                <p class="tutorial-text">
                    Hola <strong>{{ nino.nombre if nino else 'Ana' }}</strong>! 
                    Aqu√≠ ver√°s tus puntos, actividades disponibles y podr√°s empezar a aprender.
                </p>
                <div class="tutorial-buttons">
                    <button class="btn-tutorial btn-primary" onclick="nextTutorialStep()" aria-label="Continuar tutorial">
                        Siguiente
                    </button>
                    <button class="btn-tutorial btn-secondary" onclick="skipTutorial()" aria-label="Saltar tutorial">
                        Saltar
                    </button>
                </div>
            </div>
            
            <div class="tutorial-step" id="step2">
                <h2 class="tutorial-title">Tus estad√≠sticas</h2>
                <p class="tutorial-text">
                    Aqu√≠ ver√°s cu√°ntos puntos has ganado, cu√°ntas actividades has completado 
                    y cu√°ntos d√≠as seguidos has aprendido. ¬°Mientras m√°s juegues, m√°s crecer√°n!
                </p>
                <div class="tutorial-buttons">
                    <button class="btn-tutorial btn-primary" onclick="nextTutorialStep()" aria-label="Continuar tutorial">
                        Siguiente
                    </button>
                    <button class="btn-tutorial btn-secondary" onclick="prevTutorialStep()" aria-label="Anterior">
                        Anterior
                    </button>
                </div>
            </div>
            
            <div class="tutorial-step" id="step3">
                <h2 class="tutorial-title">Categor√≠as de aprendizaje</h2>
                <p class="tutorial-text">
                    Tienes 4 categor√≠as para aprender: <strong>Lenguaje</strong>, <strong>N√∫meros</strong>, 
                    <strong>Colores</strong> y <strong>Animales</strong>. Puedes tocar cualquier categor√≠a para empezar.
                </p>
                <div class="tutorial-buttons">
                    <button class="btn-tutorial btn-primary" onclick="nextTutorialStep()" aria-label="Continuar tutorial">
                        Siguiente
                    </button>
                    <button class="btn-tutorial btn-secondary" onclick="prevTutorialStep()" aria-label="Anterior">
                        Anterior
                    </button>
                </div>
            </div>
            
            <div class="tutorial-step" id="step4">
                <h2 class="tutorial-title">¬°Empezar a aprender!</h2>
                <p class="tutorial-text">
                    Presiona el bot√≥n verde "¬°Empezar Aprendizaje!" para comenzar con una actividad recomendada para ti.
                    ¬°Recuerda que siempre puedes tomar un descanso cuando lo necesites!
                </p>
                <div class="tutorial-buttons">
                    <button class="btn-tutorial btn-primary" onclick="finishTutorial()" aria-label="Terminar tutorial">
                        ¬°Empezar!
                    </button>
                    <button class="btn-tutorial btn-secondary" onclick="prevTutorialStep()" aria-label="Anterior">
                        Anterior
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- Navegaci√≥n superior -->
            <div class="header">
                <a href="/tea/" class="nav-button" aria-label="Volver al inicio">
                    üè† Volver
                </a>
                
                <!-- Avatar del sistema -->
                <div class="avatar-container" id="avatarContainer" style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10;">
                    <div class="avatar" id="avatar" style="font-size: 3rem; cursor: pointer; transition: all 0.3s ease;" onclick="interactWithAvatar()">
                        üë©‚Äçüè´
                    </div>
                    <div class="avatar-bubble" id="avatarBubble" style="position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: white; padding: 10px 15px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: none; max-width: 200px; text-align: center; font-size: 0.9rem; color: #2C3E50;">
                        <div id="avatarMessage">¬°Hola! ¬øC√≥mo est√°s?</div>
                        <div style="position: absolute; top: 100%; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid white;"></div>
                    </div>
                </div>
                
                <h1 class="welcome-message fade-in-up">
                    ¬°Hola! {{ nino.nombre if nino else 'Ana' }}
                </h1>
                <p class="subtitle fade-in-up">
                    ¬°Vamos a aprender juntos! üåü
                </p>
                
                <!-- Controles de accesibilidad -->
                <div style="position: absolute; top: 20px; right: 20px;">
                    <button onclick="toggleHighContrast()" class="btn-tutorial btn-secondary" 
                            aria-label="Alternar alto contraste" style="padding: 8px 16px; font-size: 0.9rem;">
                        üîç Contraste
                    </button>
                    <button onclick="toggleAvatarVoice()" class="btn-tutorial btn-secondary" 
                            aria-label="Alternar voz del avatar" style="padding: 8px 16px; font-size: 0.9rem; margin-left: 5px;">
                        üé§ Voz
                    </button>
                </div>
            </div>

            <!-- Estad√≠sticas mejoradas -->
            <div class="stats-grid fade-in-up">
                <div class="stat-card" tabindex="0" role="region" aria-label="Puntos esta semana">
                    <span class="stat-icon">‚≠ê</span>
                    <div class="stat-number" id="puntosSemana">0</div>
                    <div class="stat-label">Puntos esta semana</div>
                </div>
                
                <div class="stat-card" tabindex="0" role="region" aria-label="Actividades completadas">
                    <span class="stat-icon">üéØ</span>
                    <div class="stat-number" id="actividadesCompletadas">0</div>
                    <div class="stat-label">Actividades completadas</div>
                </div>
                
                <div class="stat-card" tabindex="0" role="region" aria-label="D√≠as seguidos">
                    <span class="stat-icon">üî•</span>
                    <div class="stat-number" id="diasSeguidos">0</div>
                    <div class="stat-label">D√≠as seguidos</div>
                </div>
                
                <div class="stat-card" tabindex="0" role="region" aria-label="D√≠as activos">
                    <span class="stat-icon">üìÖ</span>
                    <div class="stat-number" id="diasActivos">0</div>
                    <div class="stat-label">D√≠as activos</div>
                </div>
            </div>

            <!-- Medallas e Insignias -->
            <div class="medals-section fade-in-up" id="medalsSection" style="display: none;">
                <h3 class="section-title">üèÜ Tus Medallas</h3>
                <div id="medalsList" class="medals-grid">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Recomendaciones personalizadas -->
            <div class="recommendations fade-in-up" id="recommendationsSection" style="display: none;">
                <h3 class="section-title">üí° Recomendaciones para ti</h3>
                <div id="recommendationsList">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Categor√≠as mejoradas -->
            <div class="categories-section fade-in-up">
                <h2 class="section-title">üé® Categor√≠as de Aprendizaje</h2>
                <div class="categories-grid">
                    <div class="category-card" tabindex="0" role="button" aria-label="Categor√≠a Lenguaje"
                         onclick="selectCategory('lenguaje')" onkeydown="handleCategoryKeydown(event, 'lenguaje')">
                        <span class="category-icon">üó£Ô∏è</span>
                        <h3 class="category-title">Lenguaje</h3>
                        <p class="category-description">Aprende palabras, frases y conversaciones</p>
                        <div class="category-progress">
                            <div class="category-progress-bar" style="width: 0%" id="progressLenguaje"></div>
                        </div>
                        <div class="category-status" id="statusLenguaje">¬°Empezar!</div>
                        <div class="category-stats" id="statsLenguaje" style="font-size: 0.9rem; color: #7F8C8D; margin-top: 5px;">
                            0 de 11 actividades
                        </div>
                    </div>
                    
                    <div class="category-card" tabindex="0" role="button" aria-label="Categor√≠a N√∫meros"
                         onclick="selectCategory('numeros')" onkeydown="handleCategoryKeydown(event, 'numeros')">
                        <span class="category-icon">üî¢</span>
                        <h3 class="category-title">N√∫meros</h3>
                        <p class="category-description">Cuenta, suma, resta y resuelve problemas</p>
                        <div class="category-progress">
                            <div class="category-progress-bar" style="width: 0%" id="progressNumeros"></div>
                        </div>
                        <div class="category-status" id="statusNumeros">¬°Empezar!</div>
                        <div class="category-stats" id="statsNumeros" style="font-size: 0.9rem; color: #7F8C8D; margin-top: 5px;">
                            0 de 11 actividades
                        </div>
                    </div>
                    
                    <div class="category-card" tabindex="0" role="button" aria-label="Categor√≠a Colores"
                         onclick="selectCategory('colores')" onkeydown="handleCategoryKeydown(event, 'colores')">
                        <span class="category-icon">üé®</span>
                        <h3 class="category-title">Colores</h3>
                        <p class="category-description">Reconoce y mezcla colores</p>
                        <div class="category-progress">
                            <div class="category-progress-bar" style="width: 0%" id="progressColores"></div>
                        </div>
                        <div class="category-status" id="statusColores">¬°Empezar!</div>
                        <div class="category-stats" id="statsColores" style="font-size: 0.9rem; color: #7F8C8D; margin-top: 5px;">
                            0 de 3 actividades
                        </div>
                    </div>
                    
                    <div class="category-card" tabindex="0" role="button" aria-label="Categor√≠a Animales"
                         onclick="selectCategory('animales')" onkeydown="handleCategoryKeydown(event, 'animales')">
                        <span class="category-icon">üê∂</span>
                        <h3 class="category-title">Animales</h3>
                        <p class="category-description">Conoce animales y sus sonidos</p>
                        <div class="category-progress">
                            <div class="category-progress-bar" style="width: 0%" id="progressAnimales"></div>
                        </div>
                        <div class="category-status" id="statusAnimales">¬°Empezar!</div>
                        <div class="category-stats" id="statsAnimales" style="font-size: 0.9rem; color: #7F8C8D; margin-top: 5px;">
                            0 de 3 actividades
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bot√≥n de acci√≥n principal -->
            <div class="action-section fade-in-up">
                <a href="/tea/actividades/" class="btn-start pulse" id="btnStartLearning"
                   aria-label="Empezar aprendizaje con actividad recomendada">
                    üöÄ ¬°Empezar Aprendizaje!
                </a>
            </div>

            <!-- Zona de pausa/descanso -->
            <div class="rest-section fade-in-up">
                <h3 class="section-title">üòå Zona de Descanso</h3>
                <p style="margin-bottom: 15px; color: #7F8C8D;">
                    Si te sientes cansado o necesitas un momento de tranquilidad, puedes:
                </p>
                <button class="btn-rest" onclick="startRestActivity('breathing')" 
                        aria-label="Ejercicio de respiraci√≥n para relajarse">
                    ü´Å Respiraci√≥n
                </button>
                <button class="btn-rest" onclick="startRestActivity('music')" 
                        aria-label="Escuchar m√∫sica relajante">
                    üéµ M√∫sica
                </button>
                <button class="btn-rest" onclick="startRestActivity('stretching')" 
                        aria-label="Ejercicios de estiramiento">
                    ü§∏ Estiramiento
                </button>
            </div>
        </div>
    </div>

    <!-- Navegaci√≥n persistente unificada -->
    {% include 'tea/components/navigation.html' %}

    <script src="{{ url_for('static', filename='js/audio_system.js') }}"></script>
    <script src="{{ url_for('static', filename='js/voice_recognition.js') }}"></script>
    <script src="{{ url_for('static', filename='js/interactive_activities.js') }}"></script>
    <script src="{{ url_for('static', filename='js/rest_activities.js') }}"></script>
    <script src="{{ url_for('static', filename='js/avatar_voice_system.js') }}"></script>
    
    <script>
        // Variables globales
        let currentTutorialStep = 1;
        let isFirstVisit = localStorage.getItem('tea_first_visit') === null;
        let audioSystem = null;
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadMedals();
            loadRecommendations();
            checkFirstVisit();
            initializeAudioSystem();
            setupKeyboardNavigation();
            initializeAvatar();
        });
        
        // Verificar si es la primera visita
        function checkFirstVisit() {
            if (isFirstVisit) {
                setTimeout(() => {
                    showTutorial();
                }, 1000);
            }
        }
        
        // Sistema de tutorial
        function showTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'flex';
            document.getElementById('tutorialOverlay').focus();
        }
        
        function nextTutorialStep() {
            if (currentTutorialStep < 4) {
                document.getElementById(`step${currentTutorialStep}`).classList.remove('active');
                currentTutorialStep++;
                document.getElementById(`step${currentTutorialStep}`).classList.add('active');
                speakText(document.querySelector('.tutorial-step.active .tutorial-text').textContent);
            }
        }
        
        function prevTutorialStep() {
            if (currentTutorialStep > 1) {
                document.getElementById(`step${currentTutorialStep}`).classList.remove('active');
                currentTutorialStep--;
                document.getElementById(`step${currentTutorialStep}`).classList.add('active');
                speakText(document.querySelector('.tutorial-step.active .tutorial-text').textContent);
            }
        }
        
        function skipTutorial() {
            finishTutorial();
        }
        
        function finishTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'none';
            localStorage.setItem('tea_first_visit', 'false');
            speakText('¬°Perfecto! Ahora puedes empezar a aprender. Presiona el bot√≥n verde para comenzar.');
        }
        
        // Cargar estad√≠sticas
        async function loadStats() {
            try {
                const response = await fetch('/tea/nino/api/estadisticas');
                const data = await response.json();
                
                document.getElementById('puntosSemana').textContent = data.puntos_semana || 0;
                document.getElementById('actividadesCompletadas').textContent = data.actividades_completadas || 0;
                document.getElementById('diasSeguidos').textContent = data.dias_seguidos || 0;
                document.getElementById('diasActivos').textContent = data.dias_activos || 0;
                
                // Actualizar barras de progreso por categor√≠a
                if (data.progreso_por_categoria) {
                    updateCategoryProgress(data.progreso_por_categoria);
                }
                
                // Animar n√∫meros
                animateNumbers();
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
            }
        }
        
        // Actualizar progreso por categor√≠a
        function updateCategoryProgress(progresoData) {
            const categorias = ['lenguaje', 'numeros', 'colores', 'animales'];
            
            categorias.forEach(categoria => {
                const progreso = progresoData[categoria];
                if (progreso) {
                    const porcentaje = progreso.porcentaje_completado || 0;
                    const completadas = progreso.actividades_completadas || 0;
                    const totales = progreso.actividades_totales || 0;
                    
                    // Actualizar barra de progreso
                    const progressBar = document.getElementById(`progress${categoria.charAt(0).toUpperCase() + categoria.slice(1)}`);
                    if (progressBar) {
                        progressBar.style.width = `${porcentaje}%`;
                    }
                    
                    // Actualizar estad√≠sticas
                    const statsElement = document.getElementById(`stats${categoria.charAt(0).toUpperCase() + categoria.slice(1)}`);
                    if (statsElement) {
                        statsElement.textContent = `${completadas} de ${totales} actividades`;
                    }
                    
                    // Actualizar estado
                    const statusElement = document.getElementById(`status${categoria.charAt(0).toUpperCase() + categoria.slice(1)}`);
                    if (statusElement) {
                        if (porcentaje >= 100) {
                            statusElement.textContent = '¬°Completado!';
                            statusElement.style.color = '#27AE60';
                        } else if (porcentaje >= 50) {
                            statusElement.textContent = '¬°Muy bien!';
                            statusElement.style.color = '#3498DB';
                        } else if (porcentaje > 0) {
                            statusElement.textContent = '¬°Contin√∫a!';
                            statusElement.style.color = '#F39C12';
                        } else {
                            statusElement.textContent = '¬°Empezar!';
                            statusElement.style.color = '#7F8C8D';
                        }
                    }
                }
            });
        }
        
        // Cargar medallas del usuario
        async function loadMedals() {
            try {
                const response = await fetch('/tea/nino/api/medallas');
                const data = await response.json();
                
                if (data.success && data.medallas.length > 0) {
                    const medalsSection = document.getElementById('medalsSection');
                    const medalsList = document.getElementById('medalsList');
                    
                    medalsList.innerHTML = '';
                    data.medallas.forEach(medalla => {
                        const medalCard = document.createElement('div');
                        medalCard.className = 'medal-card';
                        medalCard.innerHTML = `
                            <span class="medal-icon">${medalla.icono}</span>
                            <div class="medal-title">${medalla.titulo}</div>
                            <div class="medal-description">${medalla.descripcion}</div>
                        `;
                        medalsList.appendChild(medalCard);
                    });
                    
                    medalsSection.style.display = 'block';
                }
            } catch (error) {
                console.error('Error cargando medallas:', error);
            }
        }
        
        // Cargar recomendaciones personalizadas
        async function loadRecommendations() {
            try {
                const response = await fetch('/tea/actividades/api/recomendaciones');
                const data = await response.json();
                
                if (data.recomendaciones && data.recomendaciones.length > 0) {
                    const section = document.getElementById('recommendationsSection');
                    const list = document.getElementById('recommendationsList');
                    
                    list.innerHTML = '';
                    data.recomendaciones.forEach(rec => {
                        const item = document.createElement('div');
                        item.className = 'recommendation-item';
                        item.innerHTML = `
                            <strong>${rec.titulo}</strong><br>
                            <small>${rec.descripcion}</small>
                        `;
                        item.onclick = () => startRecommendedActivity(rec.id);
                        list.appendChild(item);
                    });
                    
                    section.style.display = 'block';
                }
            } catch (error) {
                console.error('Error cargando recomendaciones:', error);
            }
        }
        
        // Seleccionar categor√≠a
        function selectCategory(categoria) {
            speakText(`Has seleccionado la categor√≠a ${categoria}. Vamos a empezar una actividad.`);
            
            // Animaci√≥n de selecci√≥n
            const card = event.target.closest('.category-card');
            card.style.transform = 'scale(0.95)';
            setTimeout(() => {
                card.style.transform = '';
            }, 150);
            
            // Disparar evento para el avatar
            document.dispatchEvent(new CustomEvent('categorySelected', {
                detail: { categoria: categoria }
            }));
            
            // Redirigir a la pantalla de categor√≠a
            setTimeout(() => {
                window.location.href = `/tea/actividades/categoria/${categoria}`;
            }, 500);
        }
        
        // Manejar navegaci√≥n por teclado en categor√≠as
        function handleCategoryKeydown(event, categoria) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                selectCategory(categoria);
            }
        }
        
        // Actividades de descanso
        function startRestActivity(tipo) {
            speakText(`Iniciando actividad de ${tipo} para relajarte.`);
            
            switch(tipo) {
                case 'breathing':
                    startBreathingExercise();
                    break;
                case 'music':
                    playRelaxingMusic();
                    break;
                case 'stretching':
                    startStretchingExercise();
                    break;
            }
        }
        
        function startBreathingExercise() {
            speakText('Vamos a hacer un ejercicio de respiraci√≥n. Inhala por 4 segundos, mant√©n por 4 segundos, exhala por 4 segundos.');
            // Implementar ejercicio de respiraci√≥n
        }
        
        function playRelaxingMusic() {
            speakText('Reproduciendo m√∫sica relajante para ti.');
            // Implementar m√∫sica relajante
        }
        
        function startStretchingExercise() {
            speakText('Vamos a hacer algunos estiramientos suaves. Sigue las instrucciones.');
            // Implementar ejercicios de estiramiento
        }
        
        // Actividad recomendada
        function startRecommendedActivity(actividadId) {
            speakText('Iniciando actividad recomendada para ti.');
            window.location.href = `/tea/actividades/${actividadId}`;
        }
        
        // Sistema de audio
        function initializeAudioSystem() {
            if (typeof AudioSystem !== 'undefined') {
                audioSystem = new AudioSystem();
            }
        }
        
        function speakText(text) {
            if (audioSystem) {
                audioSystem.speak(text);
            } else if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        // Animaciones
        function animateNumbers() {
            const numbers = document.querySelectorAll('.stat-number');
            numbers.forEach(num => {
                const finalValue = parseInt(num.textContent);
                let currentValue = 0;
                const increment = finalValue / 20;
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        num.textContent = finalValue;
                        clearInterval(timer);
                    } else {
                        num.textContent = Math.floor(currentValue);
                    }
                }, 50);
            });
        }
        
        // Navegaci√≥n por teclado
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', function(event) {
                // ESC para cerrar tutorial
                if (event.key === 'Escape' && document.getElementById('tutorialOverlay').style.display === 'flex') {
                    finishTutorial();
                }
                
                // Flechas para navegar tutorial
                if (document.getElementById('tutorialOverlay').style.display === 'flex') {
                    if (event.key === 'ArrowRight') {
                        nextTutorialStep();
                    } else if (event.key === 'ArrowLeft') {
                        prevTutorialStep();
                    }
                }
            });
        }
        
        // Alto contraste
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            const isHighContrast = document.body.classList.contains('high-contrast');
            localStorage.setItem('tea_high_contrast', isHighContrast);
            speakText(isHighContrast ? 'Alto contraste activado' : 'Alto contraste desactivado');
        }
        
        // Cargar preferencias guardadas
        if (localStorage.getItem('tea_high_contrast') === 'true') {
            document.body.classList.add('high-contrast');
        }
        
        // Protecci√≥n de errores
        window.addEventListener('error', function(event) {
            console.error('Error:', event.error);
            speakText('Ha ocurrido un error. Por favor, recarga la p√°gina.');
        });
        
        // Confirmaci√≥n antes de salir
        window.addEventListener('beforeunload', function(event) {
            if (document.querySelector('.category-card:hover') || document.querySelector('.btn-start:hover')) {
                event.preventDefault();
                event.returnValue = '¬øEst√°s seguro de que quieres salir?';
            }
        });
        
        // Sistema de Avatar
        function initializeAvatar() {
            // Cargar estado emocional del avatar
            loadAvatarEmotionalState();
            
            // Mostrar mensaje de bienvenida del avatar
            setTimeout(() => {
                showAvatarMessage('¬°Hola! ¬øC√≥mo est√°s hoy?', 'saludo');
            }, 2000);
        }
        
        function loadAvatarEmotionalState() {
            fetch('/tea/avatar/estado-emocional', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    nino_id: 1 // ID del ni√±o por defecto
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateAvatarAppearance(data.animacion);
                }
            })
            .catch(error => {
                console.error('Error cargando estado emocional del avatar:', error);
            });
        }
        
        function updateAvatarAppearance(animacion) {
            const avatar = document.getElementById('avatar');
            if (avatar && animacion) {
                avatar.textContent = animacion.emoji;
                avatar.style.color = animacion.color;
                
                // Aplicar animaci√≥n CSS
                avatar.style.animation = `${animacion.animacion} 2s infinite`;
            }
        }
        
        function interactWithAvatar() {
            // Obtener frase contextual del avatar
            fetch('/tea/avatar/frase', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contexto: 'motivacion',
                    nino_id: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.frase) {
                    showAvatarMessage(data.frase, 'motivacion');
                }
            })
            .catch(error => {
                console.error('Error obteniendo frase del avatar:', error);
                showAvatarMessage('¬°Hola! ¬øC√≥mo est√°s?', 'saludo');
            });
        }
        
        function showAvatarMessage(message, context = 'normal') {
            const bubble = document.getElementById('avatarBubble');
            const messageElement = document.getElementById('avatarMessage');
            
            if (bubble && messageElement) {
                messageElement.textContent = message;
                bubble.style.display = 'block';
                
                // Hablar el mensaje si el sistema de voz est√° disponible
                if (typeof speakAvatarText === 'function') {
                    speakAvatarText(message, 'excited');
                }
                
                // Ocultar el mensaje despu√©s de 4 segundos
                setTimeout(() => {
                    bubble.style.display = 'none';
                }, 4000);
            }
        }
        
        function toggleAvatarVoice() {
            const isEnabled = toggleAvatarVoice();
            const button = event.target;
            
            if (isEnabled) {
                button.textContent = 'üé§ Voz';
                button.style.background = '#3498DB';
                showAvatarMessage('¬°La voz est√° activada!', 'normal');
            } else {
                button.textContent = 'üîá Voz';
                button.style.background = '#95A5A6';
                showAvatarMessage('La voz est√° desactivada', 'normal');
            }
        }
        
        // Eventos del avatar
        document.addEventListener('categorySelected', function(event) {
            const categoria = event.detail.categoria;
            const frases = {
                'lenguaje': '¬°Vamos a practicar palabras! ¬øTe gusta hablar?',
                'numeros': '¬°Los n√∫meros son muy divertidos! ¬øQuieres contar conmigo?',
                'colores': '¬°Los colores son hermosos! ¬øCu√°l es tu favorito?',
                'animales': '¬°Los animales son nuestros amigos! ¬øQuieres conocerlos?'
            };
            
            showAvatarMessage(frases[categoria] || '¬°Vamos a aprender!', categoria);
        });
        
        document.addEventListener('activityCompleted', function(event) {
            showAvatarMessage('¬°Excelente trabajo! ¬°Eres muy inteligente!', 'felicitacion');
        });
    </script>
</body>
</html>
