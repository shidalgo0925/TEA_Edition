{% extends "base.html" %}
{% block title %}Metas Personales{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">üéØ Metas Personales</h2>

  <form method="POST" class="row g-3 mb-4">
    <div class="col-md-3">
      <input type="text" class="form-control" name="titulo" placeholder="T√≠tulo" required>
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" name="categoria" placeholder="Categor√≠a">
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" name="tipo" placeholder="Tipo (Emocional, F√≠sico)">
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" name="unidad" placeholder="Unidad (km, USD, libros)" required>
    </div>
    <div class="col-md-2">
      <input type="number" step="0.1" class="form-control" name="valor_objetivo" placeholder="Valor objetivo" required>
    </div>
    <div class="col-md-1 d-grid">
      <button type="submit" class="btn btn-success">‚ûï</button>
    </div>
  </form>

  {% if metas %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>T√≠tulo</th>
            <th>Categor√≠a</th>
            <th>Tipo</th>
            <th>Unidad</th>
            <th>Objetivo</th>
            <th>Avance</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for meta in metas %}
          <tr>
            <td>{{ meta.titulo }}</td>
            <td>{{ meta.categoria or '-' }}</td>
            <td>{{ meta.tipo or '-' }}</td>
            <td>{{ meta.unidad }}</td>
            <td>{{ meta.valor_objetivo }}</td>
            <td>
              {% set total = meta.avances | map(attribute='valor') | sum %}
              {{ total }}
              {% if total < meta.valor_objetivo %}
                <small class="text-muted">({{ (total / meta.valor_objetivo * 100) | round(1) }}%)</small>
              {% else %}
                ‚úÖ
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('metas.editar_meta', meta_id=meta.id) }}" class="btn btn-outline-primary btn-sm">‚úèÔ∏è Editar</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No hay metas registradas a√∫n.</p>
  {% endif %}
</div>
{% endblock %}
